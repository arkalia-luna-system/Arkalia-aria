name: Security Audit
on:
  schedule:
    - cron: "0 2 * * *"
  workflow_dispatch: {}

concurrency:
  group: "security-audit"
  cancel-in-progress: true

jobs:
  security-audit:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"
      - name: Install dependencies
        timeout-minutes: 5
        run: pip install -r requirements.txt || echo "‚ö†Ô∏è Some dependencies may have failed to install"
      - name: Run comprehensive security audit
        timeout-minutes: 15
        run: |
          python -c 'from devops_automation.security.aria_security_validator import ARIA_SecurityValidator; from pathlib import Path; import sys; validator = ARIA_SecurityValidator(); print("üîç Starting comprehensive security audit..."); python_files = [f for f in Path(".").rglob("*.py") if not any(excluded in str(f) for excluded in ["tests", "venv", ".venv", "arkalia_aria_venv", "__pycache__", ".git"])]; total_issues = 0; [total_issues := total_issues + len(validator.audit_code_security(py_file)["issues"]) if validator.audit_code_security(py_file)["issues"] else None for py_file in python_files[:50]]; report = validator.get_security_report(); print(f"üìä Audit complete: {total_issues} total issues found"); print(f"üìà Security report: {report[\"total_validations\"]} validations, {report[\"blocked_attempts\"]} blocked attempts"); print("‚ö†Ô∏è Security issues found - review recommended" if total_issues > 0 else "‚úÖ No security issues found"); sys.exit(0)' || echo "‚ö†Ô∏è Security audit completed with warnings"
